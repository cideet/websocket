<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <title>Title</title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <script src="__STATIC__/js/jquery.js"></script>
    <script src="__STATIC__/js/util.js"></script>
</head>
<body>

<div class="box">
    <div class="left">
        <h5>index.html</h5>
        <input class="input" placeholder="你想说啥"/>
        <button class="btn">发送信息</button>
        <div id="div"></div>
    </div>
    <div class="right">
        <h2>最后加入的用户</h2>
        <div id="members"></div>
    </div>
</div>

<script>
    //    var fromid = '<{$fromid}>';
    //    var toid = '<{$toid}>';
    var fromid = getRequest()['fromid'];
    var toid = getRequest()['toid'];
    console.log('fromid=' + fromid, 'toid=' + toid);
    var messages = [];
    var members = [];
    var htmls = '';
    var ws = new WebSocket('ws://127.0.0.1:8282');
    ws.onmessage = function (e) {
        var obj = JSON.parse(e.data);
        messages.push(obj);
        console.log('总的消息数组', messages);
        switch (obj.type) {
            case 'init':
                console.log('switch==init');
                ws.send(JSON.stringify({type: 'bind', fromid: fromid}));
                break;
            case 'login':
                console.log('switch==login');
                // members.push(obj.id);
                htmls = '<div style="font-size:20px;color:orange;">' + obj["data"] + '</div>';
                $('#members').append('<div style="height:40px;line-height:40px">' + obj.id + '</div>')
                break;
            case 'msg':
                console.log('switch==msg');
                htmls = '<div style="font-size:22px;color:blue;">' + obj["id"] + '说：' + obj["data"] + '</div>';
                break;
            case 'quit':
                console.log('switch==quit');
                htmls = '<div style="font-size:20px;color:#333;">' + obj["data"] + '</div>';
                break;
        }
        $('#div').append(htmls);
        // console.log(members);
    };

    $('.btn').click(function () {
        var msg = $('.input').val();
        ws.send(JSON.stringify({
            data: msg,
            type: 'say',
            to: toid ? toid : 'all',
            from: fromid
        }));
        $('.input').val('');
    })

</script>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body, html {
        width: 100%;
        height: 100%;
    }

    .box {
        padding: 30px;
        width: 100%;
        height: 100%;
        display: flex;
    }

    .box .left {
        flex: 1;
        border-right: 1px solid #ccc;
    }

    .box .right {
        width: 40%;
        padding-left: 30px;
    }
</style>
</body>
</html>